<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.inven.mapper.RequestMapper">

	<sql id="titleColumn">
		request_code, product_code, request_status, unit_price, factory_name, etc, file_name, total_order_quantity,
		date(request_date) as request_date, date(get_Date) as get_date, date(manufacturing_date) as manufacturing_date
	</sql>

	<sql id="commonQuery">
		select *
		from request_title rt
		join request_detail rd
		on rt.request_code = rd.request_code
	</sql>

	<!-- 디테일 테이블만 조회 -->
	<select id="searchDetail" parameterType="hashMap" resultType="hashmap">
		select *
		from request_detail
	</select>

	<!-- 조회 전체 카운트 -->
	<select id="searchCount" parameterType="hashMap" resultType="int">
		select count(*)
		from request_title
		<choose>
			<when test="confirm.equals('request_code') and !value.equals('')">
				where request_code = #{value}
			</when>
			<when test="confirm.equals('product_code') and !value.equals('')">
				where product_code = #{value}
			</when>
			<when test="confirm.equals('request_date') and !start_date.equals('') and !end_date.equals('')">
				where Date(request_date) between #{start_date} and #{end_date}
			</when>
			<when test="confirm.equals('request_status') and !value.equals('')">
				where request_status = #{value}
			</when>
		</choose>
	</select>

	<!-- 검색 및 페이징 -->
	<select id="searchWhere" parameterType="hashMap" resultType="hashmap">
		select <include refid="titleColumn"/>
		from request_title
		<choose>
			<when test="confirm.equals('request_code') and !value.equals('')">
				where request_code = #{value}
			</when>
			<when test="confirm.equals('product_code') and !value.equals('')">
				where product_code = #{value}
			</when>
			<when test="confirm.equals('request_date') and !start_date.equals('') and !end_date.equals('')">
				where Date(request_date) between #{start_date} and #{end_date}
			</when>
			<when test="confirm.equals('request_status') and !value.equals('')">
				where request_status = #{value}
			</when>
		</choose>
		LIMIT #{start_idx}, #{end_idx}
	</select>

	<update id="upStatus" parameterType="hashMap">
		UPDATE request_title
		SET request_status = #{request_status}
		WHERE request_code = #{request_code}
	</update>
</mapper>

		<!-- 조건 없이 조인해서 모두 조회 <select id="selectAll" parameterType="hashMap" resultType="hashmap">
            <include refid="commonQuery" /> </select> 발주코드를 기준으로 한 조인 조회 <select id="searchRequestCode"
            parameterType="hashMap" resultType="hashmap"> <include refid="commonQuery"
            /> and rt.request_code = '201216-01' </select> 상품코드를 기준으로 한 조인 조회 <select
            id="searchProductCode" parameterType="hashMap" resultType="hashmap"> <include
            refid="commonQuery" /> and rt.product_code = "CT002" </select> 발주 요청일을 기준으로
            한 조인 조회 <select id="searchRequestDate" parameterType="hashMap" resultType="hashmap">
            <include refid="commonQuery" /> and DATE(request_date) = '2020/12/17' </select>
            발주 요청기간(몇일~몇일 or 몇월~몇월)으로 한 조인 조회 <select id="searchRequestDates" parameterType="hashMap"
            resultType="hashmap"> <include refid="commonQuery" /> and DATE(request_date)
            between '2020/12/16' and '2020/12/17' </select> 발주 상태를 기준으로 한 조인 조회 <select
            id="searchRequestStatus" parameterType="hashMap" resultType="hashmap"> <include
            refid="commonQuery" /> and request_status = "신청" </select> -->

